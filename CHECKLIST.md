# 开发检查清单

## 前期准备 ☑️

### 云服务配置
- [ ] 注册阿里云账号
- [ ] 开通阿里云OSS服务
  - [ ] 创建Bucket: `poultry-emr`
  - [ ] 设置Bucket权限（私有读写）
  - [ ] 获取AccessKey ID和Secret
  - [ ] 配置CORS规则
- [ ] 开通通义千问DashScope服务
  - [ ] 注册账号: https://dashscope.console.aliyun.com/
  - [ ] 获取API Key
  - [ ] 充值（建议先充100元测试）
- [ ] 可选：注册MiniMax账号
  - [ ] 注册: https://api.minimax.chat/
  - [ ] 获取API Key和Group ID
- [ ] 注册微信小程序
  - [ ] 获取AppID和AppSecret
  - [ ] 配置服务器域名白名单

### 开发环境
- [ ] 安装Python 3.10+
- [ ] 安装Node.js 16+
- [ ] 安装PostgreSQL 14+
- [ ] 安装Redis 6+
- [ ] 安装HBuilderX（小程序开发）
- [ ] 安装微信开发者工具
- [ ] 安装Git（版本控制）
- [ ] 推荐：安装VSCode/PyCharm

## Phase 1: MVP基础功能

### 数据库设置
- [ ] 创建PostgreSQL数据库 `poultry_emr`
- [ ] 安装扩展
  ```sql
  CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
  CREATE EXTENSION IF NOT EXISTS "vector";
  CREATE EXTENSION IF NOT EXISTS "pg_trgm";
  ```
- [ ] 创建数据库表（15张）
  - [ ] users
  - [ ] farms
  - [ ] medical_records
  - [ ] clinical_examinations
  - [ ] diagnoses
  - [ ] treatments
  - [ ] media_files
  - [ ] lab_tests
  - [ ] follow_ups
  - [ ] record_tags
  - [ ] record_versions 🆕
  - [ ] conversations 🆕
  - [ ] conversation_messages 🆕
  - [ ] record_permissions 🆕
  - [ ] audit_logs
- [ ] 创建索引
- [ ] 插入测试数据

### 后端开发
- [ ] 项目结构搭建
  ```
  backend/
  ├── app/
  │   ├── api/v1/
  │   │   ├── __init__.py
  │   │   ├── auth.py
  │   │   ├── users.py
  │   │   ├── records.py
  │   │   ├── upload.py
  │   │   └── ...
  │   ├── models/
  │   ├── schemas/
  │   ├── services/
  │   ├── core/
  │   └── utils/
  └── main.py
  ```

- [ ] 核心功能
  - [ ] 数据库连接配置
  - [ ] 环境变量加载
  - [ ] JWT认证中间件
  - [ ] CORS配置
  - [ ] 异常处理

- [ ] 用户认证
  - [ ] 用户注册API
  - [ ] 用户登录API
  - [ ] Token刷新API
  - [ ] 密码加密
  - [ ] 获取当前用户信息

- [ ] 权限系统 🆕
  - [ ] 角色中间件（Master/兽医）
  - [ ] 权限验证装饰器
  - [ ] 检查病历访问权限函数
  - [ ] Master管理API
    - [ ] 获取用户列表
    - [ ] 激活/停用用户
    - [ ] 授权病历
    - [ ] 撤销授权
    - [ ] 查看授权记录

- [ ] 病历CRUD
  - [ ] 创建病历（含权限设置）
  - [ ] 查询病历列表（含权限过滤）
  - [ ] 查询病历详情（含权限验证）
  - [ ] 更新病历（创建新版本）
  - [ ] 软删除病历

- [ ] OSS集成
  - [ ] STS临时凭证生成
  - [ ] 文件上传API
  - [ ] 签名URL生成
  - [ ] 文件删除

- [ ] 测试
  - [ ] 单元测试
  - [ ] 集成测试
  - [ ] API文档自动生成

### 前端开发（小程序）
- [ ] 项目初始化
  ```bash
  cd frontend
  npm install
  ```

- [ ] 基础配置
  - [ ] 配置AppID
  - [ ] 配置API地址
  - [ ] 配置页面路由

- [ ] 公共组件
  - [ ] 导航栏
  - [ ] 底部Tab
  - [ ] Loading组件
  - [ ] 空状态组件
  - [ ] 确认弹窗

- [ ] 页面开发
  - [ ] 登录页
    - [ ] 手机号登录
    - [ ] 微信授权登录
    - [ ] 记住登录状态

  - [ ] 病历列表页
    - [ ] 病历卡片展示
    - [ ] 权限标识（我的/只读/可编辑）
    - [ ] 下拉刷新
    - [ ] 上拉加载更多
    - [ ] 搜索功能

  - [ ] 病历详情页
    - [ ] Markdown渲染
    - [ ] 多媒体展示
    - [ ] 权限提示
    - [ ] 编辑按钮（根据权限）
    - [ ] 导出功能

  - [ ] 病历录入页（表单）
    - [ ] 基本信息表单
    - [ ] 症状选择
    - [ ] 诊断输入
    - [ ] 治疗方案
    - [ ] 照片上传
    - [ ] 视频上传

  - [ ] 个人中心
    - [ ] 用户信息展示
    - [ ] 统计数据
    - [ ] 退出登录

### 部署测试
- [ ] 后端部署到测试服务器
- [ ] 配置Nginx反向代理
- [ ] 配置HTTPS证书
- [ ] 小程序真机测试
- [ ] 性能测试

## Phase 2: AI对话录入 🔥

### AI模型配置
- [ ] 数据库表
  - [ ] ai_models表
  - [ ] ai_usage_logs表

- [ ] LLM适配器开发
  - [ ] 基类 BaseLLMAdapter
  - [ ] 通义千问适配器 🆕
  - [ ] MiniMax适配器 🆕
  - [ ] OpenAI适配器（备用）
  - [ ] Claude适配器（备用）
  - [ ] 适配器工厂

- [ ] AI管理API（仅Master）
  - [ ] 配置AI模型
  - [ ] 获取模型列表
  - [ ] 设置默认模型
  - [ ] 测试模型
  - [ ] 查看使用统计
  - [ ] 设置使用限制

### 语音识别集成
- [ ] 微信同声传译集成
  - [ ] 小程序语音插件配置
  - [ ] 实时识别测试

- [ ] 阿里云语音识别（备选）
  - [ ] SDK集成
  - [ ] 录音文件识别
  - [ ] 实时流式识别

### 对话服务开发
- [ ] WebSocket服务
  - [ ] 连接管理
  - [ ] 消息路由
  - [ ] 错误处理
  - [ ] 心跳保活

- [ ] 对话管理
  - [ ] 创建对话会话
  - [ ] 发送用户消息
  - [ ] AI响应生成
  - [ ] 信息提取
  - [ ] 置信度计算
  - [ ] 确认机制
  - [ ] 完成对话并保存病历

- [ ] Prompt工程
  - [ ] System Prompt设计
  - [ ] Few-shot示例
  - [ ] Function Calling定义
  - [ ] 信息提取规则

### 前端对话界面
- [ ] 语音录制组件
  - [ ] 按住说话
  - [ ] 录音动画
  - [ ] 取消录音

- [ ] 对话界面组件
  - [ ] 消息气泡（用户/AI）
  - [ ] 语音播放
  - [ ] 提取信息展示
  - [ ] 确认按钮
  - [ ] 滚动到底部

- [ ] AI对话录入页
  - [ ] 开始对话
  - [ ] 实时对话
  - [ ] 暂停/继续
  - [ ] 查看病历预览
  - [ ] 确认保存

### 测试优化
- [ ] 对话流程测试
- [ ] 信息提取准确率测试
- [ ] 语音识别准确率测试
- [ ] 响应速度优化
- [ ] 成本优化

## Phase 3: 版本管理和权限

### 版本管理
- [ ] 版本创建API
- [ ] 版本列表查询
- [ ] 版本详情查询
- [ ] 版本对比
- [ ] 版本回滚

### 时间轴视图
- [ ] 提取时间序列事件
- [ ] 时间轴数据结构
- [ ] 时间轴渲染组件

### Master管理后台
- [ ] Web管理界面（Vue 3 + Element Plus）
  - [ ] 用户管理页面
  - [ ] 病历管理页面
  - [ ] 权限授权页面
  - [ ] AI模型配置页面
  - [ ] 数据统计页面

- [ ] 或使用小程序管理页面
  - [ ] 简化版管理界面

## Phase 4: 完善功能

### 搜索功能
- [ ] 全文搜索（PostgreSQL）
- [ ] 权限过滤
- [ ] 高级筛选
- [ ] 搜索结果高亮

### 导出功能
- [ ] PDF导出
- [ ] Word导出
- [ ] Excel批量导出

### 数据统计
- [ ] 疾病统计图表
- [ ] 地图可视化
- [ ] 用户活跃度
- [ ] AI使用统计

### 离线功能
- [ ] 离线缓存
- [ ] 离线编辑
- [ ] 网络恢复同步

## Phase 5: AI高级功能

### RAG系统
- [ ] Milvus向量数据库
- [ ] 病历向量化
- [ ] 相似病例检索
- [ ] 检索结果排序

### AI辅助诊断
- [ ] 症状-疾病知识库
- [ ] 诊断推荐
- [ ] 用药建议
- [ ] 疾病百科

### 图像识别
- [ ] 病变图像识别
- [ ] 症状自动标注
- [ ] 图像质量评估

## 上线准备

### 安全检查
- [ ] SQL注入测试
- [ ] XSS防护测试
- [ ] CSRF防护
- [ ] 敏感信息加密
- [ ] API限流
- [ ] 日志脱敏

### 性能优化
- [ ] 数据库查询优化
- [ ] 索引优化
- [ ] 缓存策略
- [ ] CDN加速
- [ ] 图片压缩

### 监控告警
- [ ] 服务器监控
- [ ] 数据库监控
- [ ] API监控
- [ ] 错误日志收集
- [ ] 告警通知

### 文档完善
- [ ] API文档
- [ ] 用户手册
- [ ] 运维手册
- [ ] 常见问题FAQ

### 备份恢复
- [ ] 数据库定时备份
- [ ] 备份恢复测试
- [ ] 灾难恢复预案

## 持续迭代

### 用户反馈
- [ ] 用户反馈渠道
- [ ] Bug追踪系统
- [ ] 需求收集

### 功能迭代
- [ ] A/B测试
- [ ] 灰度发布
- [ ] 版本管理

### AI模型优化
- [ ] 收集训练数据
- [ ] 模型微调
- [ ] 准确率提升

---

## 当前进度 📊

✅ **已完成**：
- 项目规划和设计
- 技术选型
- 数据库设计
- 完整文档编写
- 项目目录结构创建

🔄 **进行中**：
- 等待开始开发

⏳ **待开始**：
- Phase 1: MVP基础功能
- Phase 2: AI对话录入
- Phase 3: 版本和权限
- Phase 4: 完善功能
- Phase 5: AI高级功能

---

## 每日开发建议

### 第一天
- [ ] 配置所有云服务账号
- [ ] 安装开发环境
- [ ] 创建数据库和表

### 第一周
- [ ] 完成后端基础框架
- [ ] 实现用户认证
- [ ] 实现基础病历CRUD
- [ ] 测试OSS上传

### 第二周
- [ ] 完成权限系统
- [ ] 开发小程序基础页面
- [ ] 联调前后端接口

### 第三-四周
- [ ] 完善病历功能
- [ ] 优化用户体验
- [ ] 测试和bug修复

### 第二个月
- [ ] 开始AI对话录入功能
- [ ] 集成通义千问/MiniMax
- [ ] 开发对话界面

记得每完成一个任务就打勾 ✅，保持进度可见！
